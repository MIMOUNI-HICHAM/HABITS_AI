<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Habit Helper Bot</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Habit Helper Bot</h1>
            <p class="subtitle">Your personal habit development assistant</p>
        </div>
        <div id="chatbox"></div>
        <div class="input-container">
            <input type="text" id="user-input" placeholder="Share your thoughts or ask for advice..." autofocus>
            <button onclick="sendMessage()" class="send-button">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Function to scroll chat to bottom
        function scrollToBottom() {
            const chatbox = document.getElementById("chatbox");
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // Scroll to bottom on page load
        window.onload = scrollToBottom;

        function typeWriter(element, text, speed = 30) {
            let i = 0;
            element.innerHTML = '';
            const typing = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    scrollToBottom(); // Scroll while typing
                } else {
                    clearInterval(typing);
                }
            }, speed);
        }

        async function sendMessage() {
            const input = document.getElementById("user-input");
            const message = input.value.trim();
            if (!message) return;

            const chatbox = document.getElementById("chatbox");
            
            // Add user message with animation
            const userDiv = document.createElement("div");
            userDiv.className = "message user-message";
            userDiv.innerHTML = `<div class="message-content">${message}</div>`;
            chatbox.appendChild(userDiv);
            input.value = "";
            scrollToBottom();

            // Add bot message container
            const botDiv = document.createElement("div");
            botDiv.className = "message bot-message";
            const botContent = document.createElement("div");
            botContent.className = "message-content";
            botDiv.appendChild(botContent);
            chatbox.appendChild(botDiv);
            scrollToBottom();

            // Show typing indicator
            botContent.innerHTML = '<span class="typing-indicator">...</span>';

            try {
                const response = await fetch("/send_message", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({message})
                });

                const data = await response.json();
                
                // Remove typing indicator and start typing animation
                botContent.innerHTML = '';
                typeWriter(botContent, data.response);
            } catch (error) {
                botContent.innerHTML = "Sorry, I'm having trouble connecting. Please try again.";
            }
        }

        // Allow sending message with Enter key
        document.getElementById("user-input").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                sendMessage();
            }
        });

        // Focus input on page load
        window.onload = function() {
            document.getElementById("user-input").focus();
            scrollToBottom();
        };
    </script>
</body>
</html> 